<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>登錄</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link href="../resources/ctrl/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../resources/css/comm/base.css" rel="stylesheet">
    <link href="../resources/css/index/comm.css" rel="stylesheet">
    <link href="../resources/ctrl/font-awesome-4.7.0/css/font-awesome.css" rel="stylesheet">
    <link href="../resources/css/index/HK_Reg.css" rel="stylesheet">
    <link href="../resources/css/static/login.css" rel="stylesheet">
    <script src="../resources/js/comm/jquery.min.js"></script>
    <script src="../resources/ctrl/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
    <script src="../resources/js/arealist.js"></script>
</head>
<style>
        .head div {
        margin-bottom: 1rem;
        margin-top: 1rem;
    }
</style>
<body>
    <div id="header"></div>
    <script>
        $("#header").load("head.html");
    </script>
    <div class="content">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <div class="main">
                        <div class="login-div">
                            <div class="clear">
                                <div class="login-title pt-20 ">
                                    <div class=" login-tabcontrolv2 col-xs-6 text-right">
                                        <span>賬戶登錄</span>
                                    </div>
                                    <div class=" login-tabcontrolv1 col-xs-6 text-left">
                                        <span>免密登錄</span>
                                    </div>
                                </div>
                                <div class="clear pl-35 msg-wrap mt-20">
                                    <div class="msg-error ">
                                        <b></b><span></span>
                                    </div>
                                </div>

                                <!-- 賬戶登錄 -->
                                <div class="login-tabcontentv2 ">
                                    <form class="login-main-formpwd form-horizontal clear" method="post">
                                        <div class="clear  form-group ">
                                            <div class="clear input-group mb-20 col-xs-12">
                                                <div class="clear  login_input text-center col-xs-12  pull-left mr-0 ml-0 radius-0 pos-r ">
                                                    <input
                                                        class="form-control full-wh  usernemeinput"
                                                        type="text" name="username" maxlength="36"
                                                        placeholder="請輸入您的手機號/郵箱">
                                                    <span  class="usernamemsg  clear dis-b text-left pull-left"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class=" form-group">
                                            <div class="clear input-group mb-20 col-xs-12">
                                                <div
                                                    class="clear login_input text-center col-xs-12  pull-left mr-0 ml-0 radius-0 pos-r">
                                                    <input
                                                        class="form-control  full-wh  userpwdinput pull-left"
                                                        type="password" name="password" maxlength="12"
                                                        placeholder="請輸入您的密碼">
                                                    <span
                                                        class="userpwdmsg  clear dis-b text-left pull-left"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="clear h-30 line-h-30">
                                            <!-- 自動登錄 值為0時候未選中，為壹的時候為選中 -->
                                            <div class="ml-0 mr-10 clear pull-left pos-r i-check">
                                                <input name="rememberMe" id="rememberMe" type="checkbox" value="0">
                                                <label></label>
                                            </div>
                                            <label class="col-999 pull-left  line-h-30">下次自動登錄</label>
                                            <a class="ml-0 mr-5 clear pull-right pos-r  t-nonehove hovecol-5cb85c-bold"
                                                href="findPassword.html" style="color:rgba(45,110,153,1);">
                                                忘記密碼?
                                            </a>
                                        </div>
                                        <!--<%&#45;&#45;登入按鈕&#45;&#45;%>-->
                                        <div class="clear mt-20 mb-20">
                                            <button type="submit" class="btn full-w text-center " id="pwd-btn">
                                                登錄
                                            </button>
                                        </div>
                                    </form>
                                </div>

                                <!--  免密登錄 -->

                                <div class=" login-tabcontentv1  dis-n">
                                    <form class="login-main-formphone form-horizontal" method="post">
                                        <div class="clear h-50 form-group  phonecode-box"
                                            style="margin-left: 0px;margin-right: 0px;">
                                            <div class="input-group mt-10 mb-20 col-xs-12 pos-r">
                                                <div class="clear text-center col-xs-3   input-group-addon bg-white bor-c radius-3" style="padding: 0px;">
                                                    <select
                                                        class="form-control bor-col-white boxsha-none focu-bor-66afe9   pr-12i radius-3i sel-telphone selectpicker"
                                                        onchange="selectArea()" id="selectpicker" name="selectpicker">
                                                    </select>
                                                </div>
                                                <div
                                                    class="clear  text-center pull-left radius-0 pos-r col-xs-9  pr-0" style="padding-left: 0;">
                                                    <input  class="form-control full-wh  bor-l-none userphoneinput"
                                                        type="text" name="username" maxlength="15"
                                                        placeholder="請輸入您的手機號碼">
                                                    <span
                                                        class="userphonemsg clear dis-b text-left pull-left"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="clear h-50 form-group  mb-50 mt-30"
                                            style="margin-left: 0px;margin-right: 0px;">
                                            <div class="clear input-group mt-10 mb-20 col-xs-12 ">
                                                <div  class="clear  text-center   mr-0 ml-0  pos-r pl-0">
                                                    <input class="form-control  full-wh "  type="text" name="icode" maxlength="4" placeholder="請輸入動態密碼">
                                                    <button type="button"  class="pos-a  r-0 t-0 z-99  btn  text-center min-w-120 sendMessagebtn">
                                                        獲取動態密碼
                                                    </button>
                                                    <span
                                                        class="usercodemsg clear dis-b text-left"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div style="margin-top: 4rem;">
                                            <button type="submit" class="full-w text-center btn" id="nopwd-btn">
                                                登錄
                                            </button>
                                        </div>
                                    </form>
                                </div>
                                <div class="clear h-20 line-h-20 f-14 col-666 pl-20  text-right mt-20 mb-5">
                                    <a class="hovecol-5cb85c-bold t-nonehove mr-5 dis-ib" href="reg.html">
                                        立即註冊
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    $(document).ready(function () {

        show_msg(); //顯示異常信息

        loadAreaList(); //加載地區、區號相關數據，function位於areaList.js

        /*發送短信驗證碼*/
        $(".sendMessagebtn").click(function () { //發送短信
            sendMessage();
        });

        /*免密登錄表單驗證*/
        $(".login-main-formphone").bootstrapValidator({
            submitHandler: function (valiadtor, loginForm, submitButton) {
                valiadtor.defaultSubmit();
            },
            fields: {
                username: {
                    container: '.userphonemsg',
                    validators: {
                        notEmpty: {
                            message: '手機號碼不能為空值' //'手機號碼不能為空值.'
                        },
                        stringLength: {
                            min: 6,
                            max: 15,
                            message: '手機號碼不能小於6或者大於15' //'手機號碼不能小於6或者大於15.'
                        },
                        regexp: {
                            regexp: /^[0-9-]+$/,
                            message: '手機號碼只能包含數字和連接符' //'手機號碼只能包含數字和連接符.'
                        },
                    }
                },
                icode: {
                    container: '.usercodemsg',
                    validators: {
                        notEmpty: {
                            message: '動態密碼不能為空值' //'動態密碼不能為空值.'
                        },
                        digits: {
                            message: '只能是數字' //'只能是數字！'
                        },
                        stringLength: {
                            min: 4,
                            max: 4,
                            message: '必須是4位數字' //'必須是4位數字!'
                        }
                    }
                }
            }
        });

        /*賬號密碼登錄校驗*/
        $(".login-main-formpwd").bootstrapValidator({
            message: '請輸入用戶名/密碼', //'請輸入用戶名/密碼',
            submitHandler: function (valiadtor, loginForm, submitButton) {
                rememberMe($("input[name='rememberMe']").is(":checked"));
                valiadtor.defaultSubmit();
            },
            fields: {
                username: {
                    container: '.usernamemsg',
                    validators: {
                        notEmpty: {
                            message: '用戶名不能為空值' //'用戶名不能為空值.'
                        },
                        stringLength: {
                            max: 12,
                            message: '用戶名不能大於12位' //'用戶名不能大於12位.'
                        },
                    },
                },
                userpwd: {
                    container: '.userpwdmsg',
                    validators: {
                        notEmpty: {
                            message: '密碼不能為空值' //'密碼不能為空值.'
                        },
                        different: {
                            field: 'username',
                            message: '密碼和用戶名不能壹樣' //'密碼和用戶名不能壹樣'
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_]+$/,
                            message: '密碼只能包含大寫和小寫數字和下劃線' //'密碼只能包含大寫、小寫、數字和下劃線'
                        },
                        stringLength: {
                            min: 8,
                            message: '密碼長度不能小於8位' //'密碼長度不能小於8位.'
                        }
                    }
                },
            },
        });

        $(".show-weixinlogin").on("click", function (event) {
            event.stopPropagation();
            var target = event.target;
            if (!$(target).closest(".weixinlogin-content").length > 0 || $(target).attr("class")
                .indexOf("close-mod") != -1) {
                $(".weixinlogin-content").removeClass("ani-weixin-logoin");
                $(".weixinlogin-content").addClass("ani-weixin-logoout");
                $(".show-weixinlogin").fadeOut();
            };
        });

        /*下次自動登錄*/
        $('#rememberMe').click(function () {
            if ($(this).prop("checked")) {
                $(this).val(1);
            } else {
                $(this).val(0);
            }
        });
    });

    //----------------------------------發送驗證碼---------------------------
    function sendMessage() {
        var InterValObj; //timer變量，控制時間
        var count = 90; //間隔函數，1秒執行
        var curCount; //當前剩余秒數
        var code = ""; //驗證碼
        var codeLength = 4; //驗證碼長度
        var curCount = count;
        var phoneNumber = $(".userphoneinput").val(); //拿到當前輸入的手機號碼
        var passverify = $(".phonecode-box").hasClass("has-success");
        var select = $("#selectpicker").val();

        if (passverify) { //驗證手機號
            //產生驗證碼 ,向用戶手機發送驗證碼由後臺實現,前臺實現了倒計時
            //向後臺發送處理數據
            $.ajax({ //當點擊發送驗證碼時,可能向後臺執行的ajax事件
                type: "GET", //用POST方式傳輸
                dataType: "text", //數據格式:text
                url: http_request + "/web/call/icode?phone=" + phoneNumber + "&selectpicker=" + select,
                success: function (msg) {
                    if (msg == "200") {
                        //設置button效果，開始計時
                        $(".sendMessagebtn").attr("disabled", "true"); //禁用重新發送按鈕
                        $(".sendMessagebtn").css("color", "#666"); //修改按鈕值顏色
                        $(".sendMessagebtn").text(curCount + "s" + '重新發送'); //按鈕值修改為 '倒計時' + '重新發送'
                        InterValObj = window.setInterval(SetRemainTime, 1000); //啟動計時器，1秒執行壹次
                    } else {
                        msg = getMessage(msg);
                        showMessage(msg);
                    }
                }
            });
        } else {
            $(".userphonemsg").find("small:visible").text('請輸入正確的手機號碼'); //"請輸入正確的手機號碼！"
            $(".userphoneinput").focus(); //獲取手機號輸入框input焦點
            return false;
        }

        //timer處理函數
        function SetRemainTime() {
            if (curCount == 0) { //當倒計時等於0時
                window.clearInterval(InterValObj); //停止計時器
                $(".sendMessagebtn").removeAttr("disabled"); //啟用重新發送按鈕
                $(".sendMessagebtn").css("background-color", "#D7DCDE");
                $(".sendMessagebtn").css("border-color", "#D7DCDE");
                $(".sendMessagebtn").css("color", "#868b8a"); //修改按鈕值顏色
                $(".sendMessagebtn").text('重新發送'); //按鈕值修改為	重新發送
                code = ""; //清除驗證碼。如果不清除，過時間後，輸入收到的驗證碼依然有效
            } else {
                curCount--; //當倒計時不等於0時
                $(".sendMessagebtn").text(curCount + "s" + '重新發送'); //倒計時執行計數
            }
        };
    }

    //--------------------選項卡切換------------------------------------
    function clickLoginTab(pre_type) {
        if (pre_type == "2") {
            clickCodeLogin();
        } else if (pre_type == "1") {
            clickPwdLogin();
        }
    }

    //點擊選項卡切換
    $(".login-tabcontrolv1").click(function () {
        clickPwdLogin();
        hideMessage(); //清空異常消息欄
    });
    $(".login-tabcontrolv2").click(function () {
        clickCodeLogin();
        hideMessage(); //清空異常消息欄
    });

    //密碼登錄  選項卡
    function clickPwdLogin() {
        $(".login-tabcontrolv2").find("span").css("color", "#333333"); // 先刪除所有元素的selected樣式
        $(".login-tabcontrolv1").find("span").css("color", "#2D6E99"); // 然後為被點擊元素添加selected樣式

        $(".login-tabcontentv2").hide();
        $(".login-tabcontentv1").show();
    }

    //免密登錄  選項卡
    function clickCodeLogin() {
        $(".login-tabcontrolv1").find("span").css("color", "#333333"); // 先刪除所有元素的selected樣式
        $(".login-tabcontrolv2").find("span").css("color", "#2D6E99"); // 然後為被點擊元素添加selected樣式
        $(".login-tabcontentv1").hide();
        $(".login-tabcontentv2").show();
    }

    //------------------------異常消息顯示-------------------------------------
    function show_msg() {
        var pre_type = type;
        clickLoginTab(pre_type); //切換選項卡
        if (message != null && message != '' && message != 'null' && message != 'unfine') {
            message = getMessage(message);
            showMessage(message);
        } else {
            //從url中獲得message參數的值
            var param = window.location.search;
            var msg = getURLArg(param, "msg");
            if (msg != null && msg != "") {
                msg = getMessage(msg);
                showMessage(msg);
            }
        }
    }

    /*異常信息*/
    function showMessage(msg) {
        msg = "<b></b>" + msg;
        $(".msg-error").html(msg);
        $(".msg-error").css("display", "block");
    }

    //隱藏異常信息框
    function hideMessage() {
        msg = "";
        $(".msg-error").html(msg);
        $(".msg-error").css("display", "none");
    }

    /*根據消息代碼顯示異常信息*/
    function getMessage(msg) {
        if (msg == "200") {
            return '請登錄';
        } //請登錄!
        if (msg == "1001") {
            return '手機號不能為空';
        } //手機號不能為空！
        if (msg == "1002") {
            return '賬號未註冊,請註冊新賬號';
        } //賬號未註冊，請註冊新賬號！
        if (msg == "1004") {
            return '操作失敗';
        } //操作失敗！
        if (msg == "1005") {
            return '驗證碼錯誤';
        } //驗證碼錯誤！
        if (msg == "1007") {
            return '地區有誤';
        } //地區有誤！
        if (msg == "1008") {
            return '用戶名或密碼錯誤';
        } //用戶名或密碼錯誤！
        if (msg == "1009") {
            return '賬號鎖定';
        } //賬號鎖定！
        if (msg == "1010") {
            var pre_type = type;
            if (pre_type == 2) {
                return '用戶名或驗證碼錯誤'; //用戶名或驗證碼錯誤！
            } else {
                return '用戶名或密碼錯誤'; //用戶名或密碼錯誤！
            }
        }
        if (msg == "1011") {
            return '嘗試登錄失敗超過5次賬號鎖定8小時';
        } //嘗試登錄失敗超過5次，賬號鎖定8小時！
    }

    // /**
    //  * 獲取url參數
    //  * @param url 目標url
    //  * @param arg 目標參數名
    //  * @returns
    //  */
    function getURLArg(params, arg) {
        var reg = new RegExp("(^|&)" + arg + "=([^&]*)(&|$)");
        var r = params.substr(1).match(reg);
        if (r != null)
            return unescape(r[2]);
        return null;
    }
</script>

</html>